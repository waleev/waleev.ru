<!DOCTYPE html>
<html>
  <head>
    <title>Пишем Telegram-бота на PHP – Denis Waleev – Блог PHP-программиста</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="
Недавно наткнулся на гитхабе на один интересный проект. Сам по себе проект весьма популярный (3к+ звезд). Но я увидел на него впервые. Что примечательно написан он на PHP. И называется он “Botman”.

" />
    <meta property="og:description" content="
Недавно наткнулся на гитхабе на один интересный проект. Сам по себе проект весьма популярный (3к+ звезд). Но я увидел на него впервые. Что примечательно написан он на PHP. И называется он “Botman”.

" />
    
    <meta name="author" content="Denis Waleev" />

    
    <meta property="og:title" content="Пишем Telegram-бота на PHP" />
    <meta property="twitter:title" content="Пишем Telegram-бота на PHP" />
    
    
    
	<meta name="keywords" content="php"/>
	
    <meta name="google-site-verification" content="9Xfqmwk4ltvM6MVPDOROgmdcnc97WyNj29f4l4Fk0io" />
    
    
	  







	



    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Denis Waleev - Блог PHP-программиста" href="/feed.xml" />

  </head>

  <body>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter47159718 = new Ya.Metrika({
                        id:47159718,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true,
                        webvisor:true,
                        trackHash:true
                    });
                } catch(e) { }
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/47159718" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="/images/waleev-logo.PNG" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Denis Waleev</a></h1>
            <p class="site-description">Блог PHP-программиста</p>
          </div>

          <nav>
            <a href="/">Блог</a>
            <a href="/about">Об авторе</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Пишем Telegram-бота на PHP</h1>

  <div class="entry">
    <p><img src="/images/telegram-bot-php/botman.png" alt="BotMan Logo" title="Логотип BotMan" width="200px" class="thumb--left" />
Недавно наткнулся на гитхабе на один интересный проект. Сам по себе проект весьма популярный (3к+ звезд). Но я увидел на него впервые. Что примечательно написан он на PHP. И называется он “<em>Botman</em>”.</p>

<p><strong>Botman</strong> — PHP-фреймворк, с помощью которого вы очень просто можете написать своего бота. Он включает в себя поддержку таких платформ как:  Slack, Telegram, Facebook Messenger, WeChat и т.д.</p>

<p>Сразу скажу, что до этого времени мне еще не приходилось писать бота. И эта попытка - это, так скажем, просто “по фану”.</p>

<p>Приступим непосредственно к главному.</p>

<h2 id="установка">Установка</h2>
<p>Вообще, автора предлагает 2 варианта установки. Через Composer или же установить <a href="https://botman.io/2.0/botman-studio">BotMan Studio</a>.</p>

<p>Второй вариант я не пробовал, поэтому не могу про него ничего сказать.</p>

<p>Для начала переходим в нужную директорию (возможно сначала ее создаем).</p>

<p>Далее для установки через <strong>Composer</strong>, используем команду:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require botman/botman
</code></pre></div></div>

<p>Теперь у нас есть основные файлы для работы, но для написания бота нам еще нужен драйвер для <strong>Telegram</strong>.</p>

<p>Установить его можно следующей командой:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer require botman/driver-telegram
</code></pre></div></div>
<p>Теперь, когда у нас есть все необходимое, можем переходить к следующему шагу.</p>

<h2 id="пример-простого-кода">Пример простого кода</h2>

<p>Для старта воспользуемся примером кода из официальной документации.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">BotMan\BotMan\BotMan</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">BotMan\BotMan\BotManFactory</span><span class="p">;</span>

<span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">// конфигурация
</span>    <span class="c1">// "telegram" =&gt; [
</span>    <span class="c1">//    "token" =&gt; "TOKEN"
</span>    <span class="c1">// ]
</span><span class="p">];</span>

<span class="c1">// подключаем нужный драйвер
</span><span class="nx">DriverManager</span><span class="o">::</span><span class="na">loadDriver</span><span class="p">(</span><span class="nx">\BotMan\Drivers\Telegram\TelegramDriver</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

<span class="c1">// создаем экземпляр
</span><span class="nv">$botman</span> <span class="o">=</span> <span class="nx">BotManFactory</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>

<span class="c1">// даем боту правило для прослушивания
</span><span class="nv">$botman</span><span class="o">-&gt;</span><span class="na">hears</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">BotMan</span> <span class="nv">$bot</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$bot</span><span class="o">-&gt;</span><span class="na">reply</span><span class="p">(</span><span class="s1">'Hello yourself.'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// начинаем прослушивать
</span><span class="nv">$botman</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">();</span>
</code></pre></div></div>

<p>Кратко о содержании кода. В переменной <strong>$config</strong> нам необходимо поместить <em>токен</em> нашего Telegram-бота (<em>об этом чуть позже</em>). Далее загружаем необходимый нам драйвер для Telegram. После этого создаем экзмепляр бота BotMan и даем ему команду <em>слушать</em>.</p>

<p>В данном случае, как только бот получает сообщение ‘hello’, он отвечает сообщением ‘Hello yourself.’. Самый простой пример.</p>

<h2 id="примеры-для-hears">Примеры для hears()</h2>

<p>Рассмотрим, что как еще можно использовать этот метод.</p>

<p>Начнем с того, что callback-функцию можно определить в другом месте. Например, в отдельном классе:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$botman</span><span class="o">-&gt;</span><span class="na">hears</span><span class="p">(</span><span class="s1">'Привет'</span><span class="p">,</span> <span class="s1">'Some\Namespace\MyBotCommands@handleFoo'</span><span class="p">);</span>
<span class="c1">// прослушиваем приходящие сообщения
</span><span class="nv">$botman</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">();</span>

<span class="k">class</span> <span class="nc">MyBotCommands</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleFoo</span><span class="p">(</span><span class="nv">$bot</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$bot</span><span class="o">-&gt;</span><span class="na">reply</span><span class="p">(</span><span class="s1">'Здравствуй!'</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>
<p>Это все конечно хорошо, но хотелось бы добавить некоторой интерактивности. Например, использовать информацию из сообщения. Например, написать простую функцию для того, чтобы передать привет:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$botman</span><span class="o">-&gt;</span><span class="na">hears</span><span class="p">(</span><span class="s1">'Передай привет {name}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$bot</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$bot</span><span class="o">-&gt;</span><span class="na">reply</span><span class="p">(</span><span class="s1">'Привет '</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">'!'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Также мы можем использовать регулярные выражения:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$botman</span><span class="o">-&gt;</span><span class="na">hears</span><span class="p">(</span><span class="s1">'Я хочу цифру ([0-9]+)'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$bot</span><span class="p">,</span> <span class="nv">$number</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$bot</span><span class="o">-&gt;</span><span class="na">reply</span><span class="p">(</span><span class="s1">'Получи цифру '</span><span class="o">.</span><span class="nv">$number</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="создаем-telegram-бота">Создаем Telegram-бота</h2>
<p>Для того, чтобы создать нового бота, вам достаточно написать <a href="https://t.me/botfather">этому боту</a> (@BotFather).</p>

<p>Просто введите команду <code class="highlighter-rouge">/newbot</code> и следуйте инструкциям. Вам потребуется ввести имя бота и его никнейм. После этого вы получите свой API токен. Он то как раз нам и понадобится.</p>

<p>Теперь нам необходимо <strong>зарегистрировать</strong> нашего бота. Точнее сообщить Телеграму то, где находится наш бот.</p>

<p>Сделать это можно, отправив POST-запрос по такому адресу:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://api.telegram.org/bot&lt;ВАШ-ТОКЕН&gt;/setWebhook
</code></pre></div></div>

<p>В качестве данных необходимо передать всего 1 параметр - <code class="highlighter-rouge">url</code>.  Значением должен быть адрес, по которому доступен ваш бот. Для обеспечения безопасности <strong>должен</strong> использоваться только HTTPS.</p>

<h2 id="заключение">Заключение</h2>
<p>На этом хотелось бы данный пост закончить. Несмотря на то, что конечного продукта у нас не получилось, мы рассмотрели основные моменты, которых для начала будет достаточно. В любом случае быо интересно попробовать.</p>

<p>Для того, чтобы написать своего бота нужна <strong>идея</strong>. Он должен быть хоть сколько-нибудь полезным. Идей у меня пока нет, и поэтому не вижу смысла что-то делать.</p>

<p>Будут идеи - будет и продолжение. <em>Спасибо за внимание!</em></p>


  </div>

  <hr>

  <div class="date">
    Дата публикации: 28.12.2017
  </div>

  
</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          



<a href="https://github.com/webdinislam"><i class="svg-icon github"></i></a>



<a href="/feed.xml"><i class="svg-icon rss"></i></a>




<a href="https://vk.com/webdinislam"><i class="svg-icon vk"></i></a>

        </footer>
      </div>
    </div>

    

  </body>
</html>
